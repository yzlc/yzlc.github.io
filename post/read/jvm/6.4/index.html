<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>6.4　字节码指令简介 - lim</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="lim"><meta name=description content="6.4.1 字节码与数据类型 编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将bo"><meta name=keywords content="lim"><meta name=generator content="Hugo 0.110.0 with theme even"><link rel=canonical href=https://yzlc.github.io/post/read/jvm/6.4/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><link rel=stylesheet href=/css/dark.css><link rel=stylesheet href=/css/custom.css><meta property="og:title" content="6.4　字节码指令简介"><meta property="og:description" content="6.4.1 字节码与数据类型 编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将bo"><meta property="og:type" content="article"><meta property="og:url" content="https://yzlc.github.io/post/read/jvm/6.4/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-05-27T10:32:33+08:00"><meta property="article:modified_time" content="2024-03-25T10:01:11+08:00"><meta itemprop=name content="6.4　字节码指令简介"><meta itemprop=description content="6.4.1 字节码与数据类型 编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将bo"><meta itemprop=datePublished content="2020-05-27T10:32:33+08:00"><meta itemprop=dateModified content="2024-03-25T10:01:11+08:00"><meta itemprop=wordCount content="2778"><meta itemprop=keywords content="jvm,"><meta name=twitter:card content="summary"><meta name=twitter:title content="6.4　字节码指令简介"><meta name=twitter:description content="6.4.1 字节码与数据类型 编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将bo"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>lim</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=/post/web><li class=mobile-menu-item>网站大全</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>lim</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=/post/web>网站大全</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>6.4　字节码指令简介</h1><div class=post-meta><span class=post-time>2020-05-27</span><div class=post-category><a href=/categories/read/>read</a></div><span class=more-meta>约 2778 字</span>
<span class=more-meta>预计阅读 6 分钟</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#641字节码与数据类型>6.4.1　字节码与数据类型</a></li><li><a href=#642加载和存储指令>6.4.2　加载和存储指令</a></li><li><a href=#643运算指令>6.4.3　运算指令</a></li><li><a href=#644类型转换指令>6.4.4　类型转换指令</a></li><li><a href=#645对象创建与访问指令>6.4.5　对象创建与访问指令</a></li><li><a href=#646操作数栈管理指令>6.4.6　操作数栈管理指令</a></li><li><a href=#647控制转移指令>6.4.7　控制转移指令</a></li><li><a href=#648方法调用和返回指令>6.4.8　方法调用和返回指令</a></li><li><a href=#649异常处理指令>6.4.9　异常处理指令</a></li><li><a href=#6410同步指令>6.4.10　同步指令</a></li></ul></li></ul></nav></div></div><div class=post-content><h3 id=641字节码与数据类型>6.4.1　字节码与数据类型</h3><blockquote><p>编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将boolean和char类型数据零位扩展（Zero-Extend）为相应的int类型数据。因此，大多数对于boolean、byte、short和char类型数据的操作，实际上都是使用相应的对int类型作为运算类型（Computational Type）来进行的</p></blockquote><p>Java虚拟机指令集所支持的数据类型</p><table><thead><tr><th>opcode</th><th>byte</th><th>short</th><th>int</th><th>long</th><th>float</th><th>double</th><th>char</th><th>reference</th></tr></thead><tbody><tr><td>Tipush</td><td>bipush</td><td>sipush</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Tconst</td><td></td><td></td><td>iconst</td><td>lconst</td><td>fconst</td><td>dconst</td><td></td><td>aconst</td></tr><tr><td>Tload</td><td></td><td></td><td>iload</td><td>lload</td><td>fload</td><td>dload</td><td></td><td>aload</td></tr><tr><td>Tstore</td><td></td><td></td><td>istore</td><td>lstore</td><td>fstore</td><td>dstore</td><td></td><td>astore</td></tr><tr><td>Tinc</td><td></td><td></td><td>iinc</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Taload</td><td>baload</td><td>saload</td><td>iaload</td><td>laload</td><td>faload</td><td>daload</td><td>caload</td><td>aaload</td></tr><tr><td>Tastore</td><td>bastore</td><td>sastore</td><td>iastore</td><td>lastore</td><td>fastore</td><td>dastore</td><td>castore</td><td>aastore</td></tr><tr><td>Tadd</td><td></td><td></td><td>iadd</td><td>ladd</td><td>fadd</td><td>dadd</td><td></td><td></td></tr><tr><td>Tsub</td><td></td><td></td><td>isub</td><td>lsub</td><td>fsub</td><td>dsub</td><td></td><td></td></tr><tr><td>Tmul</td><td></td><td></td><td>imul</td><td>lmul</td><td>fmul</td><td>dmul</td><td></td><td></td></tr><tr><td>Tdiv</td><td></td><td></td><td>idiv</td><td>ldiv</td><td>fdiv</td><td>ddiv</td><td></td><td></td></tr><tr><td>Trem</td><td></td><td></td><td>irem</td><td>lrem</td><td>frem</td><td>drem</td><td></td><td></td></tr><tr><td>Tneg</td><td></td><td></td><td>ineg</td><td>lneg</td><td>fneg</td><td>dneg</td><td></td><td></td></tr><tr><td>Tshl</td><td></td><td></td><td>ishl</td><td>lshl</td><td></td><td></td><td></td><td></td></tr><tr><td>Tshr</td><td></td><td></td><td>ishr</td><td>lshr</td><td></td><td></td><td></td><td></td></tr><tr><td>Tushr</td><td></td><td></td><td>iushr</td><td>lushr</td><td></td><td></td><td></td><td></td></tr><tr><td>Tand</td><td></td><td></td><td>iand</td><td>land</td><td></td><td></td><td></td><td></td></tr><tr><td>Tor</td><td></td><td></td><td>ior</td><td>lor</td><td></td><td></td><td></td><td></td></tr><tr><td>Txor</td><td></td><td></td><td>ixor</td><td>lxor</td><td></td><td></td><td></td><td></td></tr><tr><td>i2T</td><td>i2b</td><td>i2s</td><td></td><td>i2l</td><td>i2f</td><td>i2d</td><td></td><td></td></tr><tr><td>l2T</td><td></td><td></td><td>l2i</td><td></td><td>l2f</td><td>l2d</td><td></td><td></td></tr><tr><td>f2T</td><td></td><td></td><td>f2i</td><td>f2l</td><td></td><td>f2d</td><td></td><td></td></tr><tr><td>d2T</td><td></td><td></td><td>d2i</td><td>d2l</td><td>d2f</td><td></td><td></td><td></td></tr><tr><td>Tcmp</td><td></td><td></td><td></td><td>lcmp</td><td></td><td></td><td></td><td></td></tr><tr><td>Tcmp1</td><td></td><td></td><td></td><td></td><td>fcmpl</td><td>dcmpl</td><td></td><td></td></tr><tr><td>Tcmpg</td><td></td><td></td><td></td><td></td><td>fcmpg</td><td>dcmpg</td><td></td><td></td></tr><tr><td>if_TcmpOP</td><td></td><td></td><td>if_icmpOP</td><td></td><td></td><td></td><td></td><td>if_acmpOP</td></tr><tr><td>Treturn</td><td></td><td></td><td>ireturn</td><td>lreturn</td><td>freturn</td><td>dreturn</td><td></td><td>areturn</td></tr></tbody></table><h3 id=642加载和存储指令>6.4.2　加载和存储指令</h3><blockquote><p>加载和存储指令用于将数据在栈帧中的局部变量表和操作数栈之间来回传输</p></blockquote><p>将一个局部变量加载到操作栈：iload、iload_、lload、lload_、fload、fload_、dload、dload_、aload、aload_</p><p>将一个数值从操作数栈存储到局部变量表：istore、istore_、lstore、lstore_、fstore、fstore_、dstore、dstore_、astore、astore_</p><p>将一个常量加载到操作数栈：bipush、sipush、ldc、ldc_w、ldc2_w、aconst_null、iconst_m1、iconst_、lconst_、fconst_、dconst_</p><p>扩充局部变量表的访问索引的指令：wide</p><h3 id=643运算指令>6.4.3　运算指令</h3><blockquote><p>对两个操作数栈上的值进行某种特定运算，并把结果重新存入到操作栈顶.遵循IEEE754规范</p></blockquote><p>加法指令：iadd、ladd、fadd、dadd</p><p>减法指令：isub、lsub、fsub、dsub</p><p>乘法指令：imul、lmul、fmul、dmul</p><p>除法指令：idiv、ldiv、fdiv、ddiv</p><p>求余指令：irem、lrem、frem、drem</p><p>取反指令：ineg、lneg、fneg、dneg</p><p>位移指令：ishl、ishr、iushr、lshl、lshr、lushr</p><p>按位或指令：ior、lor</p><p>按位与指令：iand、land</p><p>按位异或指令：ixor、lxor</p><p>局部变量自增指令：iinc</p><p>比较指令：dcmpg、dcmpl、fcmpg、fcmpl、lcmp</p><h3 id=644类型转换指令>6.4.4　类型转换指令</h3><p>窄化类型转换（Narrowing Numeric Conversion）必须显式使用转换指令完成，指令包括i2b、i2c、i2s、l2i、f2i、f2l、d2i、d2l和d2f</p><p>int或long类型窄化为T:丢弃除最低位N(T的数据类型长度)字节以外的内容，可能导致转换结果与输入值有不同的正负号</p><p>浮点值窄化转换为T（T限于int或long）：</p><ul><li>如果浮点值是NaN，那转换结果就是int或long类型的0</li><li>如果浮点值不是无穷大的话，浮点值使用IEEE 754的向零舍入模式取整，获得整数值v。如果v在目标类型T（int或long）的表示范围之类，那转换结果就是v；否则，将根据v的符号，转换为T所能表示的最大或者最小正数</li></ul><h3 id=645对象创建与访问指令>6.4.5　对象创建与访问指令</h3><p>创建类实例的指令：new</p><p>创建数组的指令：newarray、anewarray、multianewarray</p><p>访问类字段（static字段，或者称为类变量）和实例字段（非static字段，或者称为实例变量）的指令：getfield、putfield、getstatic、putstatic</p><p>把一个数组元素加载到操作数栈的指令：baload、caload、saload、iaload、laload、faload、daload、aaload</p><p>将一个操作数栈的值储存到数组元素中的指令：bastore、castore、sastore、iastore、fastore、dastore、aastore</p><p>取数组长度的指令：arraylength</p><p>检查类实例类型的指令：instanceof、checkcast</p><h3 id=646操作数栈管理指令>6.4.6　操作数栈管理指令</h3><p>将操作数栈的栈顶一个或两个元素出栈：pop、pop2</p><p>复制栈顶一个或两个数值并将复制值或双份的复制值重新压入栈顶：dup、dup2、dup_x1、dup2_x1、dup_x2、dup2_x2</p><p>将栈最顶端的两个数值互换：swap</p><h3 id=647控制转移指令>6.4.7　控制转移指令</h3><blockquote><p>让Java虚拟机有条件或无条件地从指定位置指令（而不是控制转移指令）的下一条指令继续执行程序，从概念模型上理解，可以认为控制指令就是在有条件或无条件地修改PC寄存器的值</p></blockquote><p>条件分支：ifeq、iflt、ifle、ifne、ifgt、ifge、ifnull、ifnonnull、if_icmpeq、if_icmpne、if_icmplt、if_icmpgt、if_icmple、if_icmpge、if_acmpeq和if_acmpne</p><p>复合条件分支：tableswitch、lookupswitch</p><p>无条件分支：goto、goto_w、jsr、jsr_w、ret</p><h3 id=648方法调用和返回指令>6.4.8　方法调用和返回指令</h3><p>方法调用</p><ul><li>invokevirtual指令：用于调用对象的实例方法，根据对象的实际类型进行分派（虚方法分派），这也是Java语言中最常见的方法分派方式</li><li>invokeinterface指令：用于调用接口方法，它会在运行时搜索一个实现了这个接口方法的对象，找出适合的方法进行调用</li><li>invokespecial指令：用于调用一些需要特殊处理的实例方法，包括实例初始化方法、私有方法和父类方法</li><li>invokestatic指令：用于调用类静态方法（static方法）</li><li>invokedynamic指令：用于在运行时动态解析出调用点限定符所引用的方法。并执行该方法。前面四条调用指令的分派逻辑都固化在Java虚拟机内部，用户无法改变，而invokedynamic指令的分派逻辑是由用户所设定的引导方法决定的</li></ul><p>方法返回指令:根据返回值的类型区分，包括ireturn（当返回值是boolean、byte、char、short和int类型时使用）、lreturn、freturn、dreturn和areturn，另外还有一条return指令供声明为void的方法、实例初始化方法、类和接口的类初始化方法使用</p><h3 id=649异常处理指令>6.4.9　异常处理指令</h3><blockquote><p>由athrow指令实现,许多运行时异常会在其他Java虚拟机指令检测到异常状况时自动抛出.采用异常表完成</p></blockquote><h3 id=6410同步指令>6.4.10　同步指令</h3><blockquote><p>使用管程（Monitor，更常见的是直接将它称为“锁”）实现方法级的同步:检查方法的ACC_SYNCHRONIZED访问标志是否被设置，如果设置了，执行线程就要求先成功持有管程，然后才能执行方法，最后当方法完成（无论是正常完成还是非正常完成）时释放管程同步一段指令集序列:monitorenter和monitorexit两条指令</p></blockquote></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>lim</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2024-03-25
<a href=https://github.com/yzlc/www/commit/c7de67ffea533462b0e02f6edfdbb3ccb744b28a title="Merge branches 'master' and 'master' of https://github.com/yzlc/blog">(c7de67f)</a></span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=/images/reward/wechat.jpg>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=/images/reward/alipay.jpg>
<span>支付宝打赏</span></label></div></div><footer class=post-footer><div class=post-tags><a href=/tags/jvm/>jvm</a></div><nav class=post-nav><a class=prev href=/post/read/jvm/7/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">第7章　虚拟机类加载机制</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/read/jvm/6.3/><span class="next-text nav-default">6.3　Class类文件的结构</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=vcomments></div><script src=//cdn1.lncld.net/static/js/3.0.4/av-min.js></script>
<script src=//unpkg.com/valine/dist/Valine.min.js></script>
<script type=text/javascript>new Valine({el:"#vcomments",appId:"eqLcOvlY4d8bxdMA47BQqwRV-gzGzoHsz",appKey:"fhXztPgcCKoM3Tlof1DEGnB8",notify:!1,verify:!1,avatar:"mm",placeholder:"说点什么吧...",visitor:!1})</script></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:yzlc233@outlook.com class="iconfont icon-email" title=email></a>
<a href=https://github.com/yzlc class="iconfont icon-github" title=github></a>
<a href=https://space.bilibili.com/10341737 class="iconfont icon-bilibili" title=bilibili></a>
<a href=https://yzlc.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次</span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人</span></div><span class=copyright-year>&copy;
2019 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>lim</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-154585647-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>